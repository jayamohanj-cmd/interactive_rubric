<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Rubric: My Independent Project Journey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Library for PDF and Image Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lexend:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Lexend', sans-serif;
        }
        .interactive-link {
            font-weight: 600;
            background-color: #e0e7ff; /* bg-indigo-100 */
            border-radius: 0.25rem; /* rounded */
            padding: 2px 6px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .interactive-link:hover {
            background-color: #c7d2fe; /* bg-indigo-200 */
        }
        .modal-overlay {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            transform: scale(0.95) translateY(10px);
            transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1) translateY(0);
        }
        .level-card {
            cursor: pointer;
            position: relative;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .level-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .selected-card {
            box-shadow: 0 0 0 3px #4f46e5; /* Indigo-600 */
            border-color: #4f46e5 !important;
        }
        .selected-card .selection-indicator {
            background-color: #4f46e5; /* indigo-600 */
            border-color: #4f46e5; /* indigo-600 */
        }
        .selected-card .checkmark {
            opacity: 1;
        }
        /* Custom slider styles */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]:focus {
            outline: none;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #e2e8f0; /* slate-200 */
            border-radius: 9999px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #4f46e5; /* indigo-600 */
            cursor: pointer;
            margin-top: -6px; /* Center thumb on track */
        }
        input[type=range]:disabled::-webkit-slider-thumb {
            background: #94a3b8; /* slate-400 */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <!-- Header Section -->
        <header class="text-center mb-10 md:mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900">My Independent Project Journey</h1>
            <p class="mt-3 text-lg text-slate-600 max-w-3xl mx-auto">A self-assessment tool to help you plan your next steps.</p>
            
            <!-- Instructions Block -->
            <div class="mt-8 max-w-2xl mx-auto bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h2 class="text-xl font-bold text-slate-800 mb-4">How to Use This Tool</h2>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-left">
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 h-10 w-10 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center font-bold text-lg">1</div>
                        <div>
                            <h3 class="font-semibold text-slate-700">Select Your Level</h3>
                            <p class="text-sm text-slate-500">For each category, click the card that best describes your current progress.</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 h-10 w-10 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center font-bold text-lg">2</div>
                        <div>
                            <h3 class="font-semibold text-slate-700">Adjust Confidence</h3>
                            <p class="text-sm text-slate-500">Use the slider to show how confident you feel about that category.</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 h-10 w-10 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center font-bold text-lg">3</div>
                        <div>
                            <h3 class="font-semibold text-slate-700">Create Roadmap</h3>
                            <p class="text-sm text-slate-500">Click the button below to generate your personalized action plan.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Name Input -->
            <div class="mt-8 max-w-md mx-auto">
                 <label for="student-name" class="block text-sm font-medium text-slate-700 mb-1">Enter Your Name</label>
                 <input type="text" id="student-name" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="e.g., Alex Doe">
            </div>

            <div class="mt-8">
                <button class="create-roadmap-btn bg-indigo-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 disabled:bg-slate-400 disabled:cursor-not-allowed disabled:shadow-none" disabled>
                    Create My Roadmap
                </button>
            </div>
        </header>

        <!-- Rubric Section -->
        <main>
            <div id="rubric-container" class="space-y-6">
                <!-- Rubric content will be injected here by JavaScript -->
            </div>
        </main>
        
        <!-- Bottom Button Section -->
        <footer class="mt-12 text-center">
            <button class="create-roadmap-btn bg-indigo-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 disabled:bg-slate-400 disabled:cursor-not-allowed disabled:shadow-none" disabled>
                Create My Roadmap
            </button>
        </footer>

    </div>

    <!-- Details Modal Structure -->
    <div id="details-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="modal-content relative bg-white w-full max-w-lg rounded-xl shadow-2xl p-6 md:p-8">
            <button class="modal-close-icon absolute top-4 right-4 text-slate-400 hover:text-slate-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h3 id="details-modal-title" class="text-2xl font-bold mb-4 text-slate-900"></h3>
            <div id="details-modal-body" class="text-slate-700 space-y-4 prose max-w-none"></div>
            <button class="modal-close-button mt-8 w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform active:scale-95">Close</button>
        </div>
    </div>

    <!-- Roadmap Modal Structure -->
    <div id="roadmap-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="modal-content flex flex-col bg-white w-full max-w-2xl rounded-xl shadow-2xl max-h-[90vh]">
            <div id="pdf-export-area" class="p-6 md:p-8 overflow-y-auto">
                <h3 class="text-3xl font-bold mb-2 text-slate-900">Your Project Roadmap</h3>
                <p class="text-slate-600 mb-6">Here is your personalized plan based on your self-assessment. Use this as a guide for your next steps.</p>
                <div id="roadmap-modal-body" class="space-y-6"></div>
                 <div class="mt-6">
                    <label for="reflection-text" class="block text-lg font-bold text-slate-800 mb-2">My Goal for This Week</label>
                    <textarea id="reflection-text" rows="4" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="After reviewing my roadmap, my main goal is to..."></textarea>
                </div>
            </div>
            <div class="flex-shrink-0 p-6 md:p-8 pt-4 bg-slate-50 rounded-b-xl border-t border-slate-200 flex flex-col sm:flex-row gap-3">
                <button id="download-pdf-btn" class="w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform active:scale-95">Download as PDF</button>
                <button id="view-map-btn" class="w-full bg-white text-slate-700 font-semibold py-3 px-4 rounded-lg border border-slate-300 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform active:scale-95">View Mind Map</button>
                <button class="modal-close-button w-full bg-white text-slate-700 font-semibold py-3 px-4 rounded-lg border border-slate-300 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform active:scale-95 sm:w-auto">Close</button>
            </div>
        </div>
    </div>

    <!-- Mind Map Modal Structure -->
    <div id="mind-map-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="modal-content flex flex-col bg-white w-full max-w-5xl rounded-xl shadow-2xl max-h-[90vh]">
             <div class="p-6 md:p-8 border-b border-slate-200">
                <h3 class="text-2xl font-bold text-slate-900">Your Project Mind Map</h3>
            </div>
            <div class="p-6 md:p-8 overflow-auto bg-slate-50/50 flex-grow">
                <div id="mind-map-container" class="relative w-[1200px] h-[800px] mx-auto">
                    <!-- Mind map will be generated here -->
                </div>
            </div>
            <div class="flex-shrink-0 p-6 md:p-8 pt-4 bg-slate-50 rounded-b-xl border-t border-slate-200 flex justify-end gap-3">
                <button id="download-map-btn" class="bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform active:scale-95">Download as Image</button>
                <button class="modal-close-button bg-white text-slate-700 font-semibold py-2 px-6 rounded-lg border border-slate-300 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform active:scale-95">Close</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DATA ---
            const rubricData = [
                {
                    criterion: "Proposal & Plan",
                    subtitle: "The 'Why' and 'How'",
                    levels: [
                        { title: "Exemplary", description: "I can design a <span class='interactive-link' data-modal-id='compelling-project'>compelling project</span> with a clear vision and a <span class='interactive-link' data-modal-id='detailed-plan'>detailed, actionable plan</span>.", nextStep: "Fantastic! Double-check your timeline. Is it realistic? Share your plan with a friend to see if it's clear to them." },
                        { title: "Proficient", description: "I can design a project with a clear goal and a <span class='interactive-link' data-modal-id='solid-plan'>solid plan</span>.", nextStep: "Great start! Now, think about potential problems. What could go wrong, and what's your backup plan? Add a 'Potential Problems' section to your plan." },
                        { title: "Developing", description: "I can propose a project idea and create a <span class='interactive-link' data-modal-id='basic-plan'>basic plan</span>.", nextStep: "Good job getting your idea down. Now, let's add detail. Break down each step of your basic plan into 2-3 smaller, more specific actions." },
                        { title: "Beginning", description: "I'm still exploring ideas and haven't settled on a project yet.", nextStep: "No problem! Spend 15 minutes browsing the 'Need Help?' resources. Write down three topics that spark your curiosity. Don't worry about the final project yet, just get curious!" }
                    ]
                },
                {
                    criterion: "Process & Investigation",
                    subtitle: "The 'Work'",
                    levels: [
                        { title: "Exemplary", description: "I can demonstrate a <span class='interactive-link' data-modal-id='deep-investigation'>deep and persistent investigation</span>, adapting and growing through <span class='interactive-link' data-modal-id='growing-challenges'>challenges</span>.", nextStep: "Excellent work. Challenge yourself to try one new technique or material that you're not familiar with, even if it doesn't make it into the final piece." },
                        { title: "Proficient", description: "I can follow my plan while <span class='interactive-link' data-modal-id='investigating'>investigating</span> and problem-solving along the way.", nextStep: "You're on the right track. This week, find one artist whose work relates to your project and write down three things you learned from looking at their art." },
                        { title: "Developing", description: "I can follow my plan with <span class='interactive-link' data-modal-id='some-investigation'>some investigation</span>.", nextStep: "Let's get curious. Before you start working next, spend 10 minutes sketching or testing out an idea on a scrap piece of paper. Don't be afraid to make a 'mistake'." },
                        { title: "Beginning", description: "I follow the most direct path to a final product with little investigation.", nextStep: "A great way to start investigating is to ask 'What if?'. For example, 'What if I used a different color?' or 'What if I made this part bigger?'. Ask and explore one 'What if?' question." }
                    ]
                },
                {
                    criterion: "The Final Artwork",
                    subtitle: "The 'What'",
                    levels: [
                        { title: "Exemplary", description: "My artwork is an <span class='interactive-link' data-modal-id='innovative-realization'>innovative and well-crafted realization</span> of my idea.", nextStep: "Amazing! Now, consider the presentation. How can you light, photograph, or display your work to make it even more powerful?" },
                        { title: "Proficient", description: "My artwork is a <span class='interactive-link' data-modal-id='clear-realization'>clear and well-crafted response</span> to my idea.", nextStep: "You're doing great. Ask for feedback from two people. Ask them: 'What's the first thing you notice?' and 'What do you think this piece is about?'." },
                        { title: "Developing", description: "My artwork shows my idea, but could be <span class='interactive-link' data-modal-id='more-developed'>more developed or better crafted</span>.", nextStep: "Let's focus on craftsmanship. Identify one part of your artwork that feels rushed. Spend 20 minutes just on that one area, refining and improving it." },
                        { title: "Beginning", description: "My artwork is incomplete or does not connect to my original idea.", nextStep: "It's okay to feel stuck. Re-read your original proposal. What was the most exciting part of your idea? Focus on completing just that one part first." }
                    ]
                },
                {
                    criterion: "Reflection & Presentation",
                    subtitle: "The 'So What'",
                    levels: [
                        { title: "Exemplary", description: "I can thoughtfully <span class='interactive-link' data-modal-id='articulate-journey'>articulate my entire creative journey</span>, connecting it to my growth as a learner.", nextStep: "Wonderful reflection. Now, try to summarize your entire project journey into a single, powerful sentence. This is great practice for artist statements." },
                        { title: "Proficient", description: "I can <span class='interactive-link' data-modal-id='explain-project'>clearly explain my project</span> and reflect on my process.", nextStep: "Solid reflection. Now, let's go deeper. What is one thing you learned during this project that has nothing to do with art skills (e.g., about time management, or yourself)?" },
                        { title: "Developing", description: "I can <span class='interactive-link' data-modal-id='briefly-describe'>briefly describe my project</span>.", nextStep: "A good first step. Try this sentence starter: 'I created this artwork because...'. Complete it in your own words. This is the beginning of a great artist statement." },
                        { title: "Beginning", description: "I have not reflected on or presented my work.", nextStep: "Reflection is a key part of learning. Start small. Write down one thing that was challenging about this project and one thing you enjoyed." }
                    ]
                }
            ];
            const modalContent = {
                'compelling-project': { title: 'Compelling Project', body: `<p>A compelling project goes beyond a simple assignment. It's driven by your own curiosity.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>Your central question is unique and personal to you.</li><li>It connects to your interests, identity, or the world around you.</li><li>It makes others curious to see what you will create.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>What question are you trying to answer with your art that you don't already know the answer to?</p>` },
                'detailed-plan': { title: 'Detailed, Actionable Plan', body: `<p>A great plan is a roadmap that anticipates the journey ahead.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>A list of steps from start to finish.</li><li>A realistic timeline with self-imposed deadlines.</li><li>A section for "Potential Problems" and ideas for how to solve them.</li><li>Links to research or artists who inspire you.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>If you had to hand your plan to a friend, could they understand and follow your steps?</p>` },
                'solid-plan': { title: 'Solid Plan', body: `<p>A solid plan has all the essential components to get you started.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>A clear goal is stated.</li><li>The main steps are listed in order.</li><li>A list of needed materials is included.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>What is the very first physical action you need to take to begin?</p>` },
                'basic-plan': { title: 'Basic Plan', body: `<p>A basic plan is a starting point, but may be missing key details.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>A general idea is written down.</li><li>A few steps might be listed, but they may be out of order.</li><li>It might be unclear what materials are needed.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>What are three steps you need to take between your idea and the finished piece?</p>` },
                'deep-investigation': { title: 'Deep Investigation', body: `<p>This means you are acting like a detective, actively hunting for information and ideas.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>Sketchbook pages filled with notes, drawings, and material tests.</li><li>Trying a technique multiple times to get it right.</li><li>Looking at artists you've never studied before.</li><li>Changing your idea based on something new you learned.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>What is one new skill or idea you could explore this week that you're not sure will work?</p>` },
                'growing-challenges': { title: 'Growing Through Challenges', body: `<p>Challenges are not failures; they are opportunities. This is about how you respond when things go wrong.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>Documenting mistakes in your sketchbook and what you learned.</li><li>Not being afraid to start a part of the project over.</li><li>Asking for specific feedback when you are stuck.</li><li>Your final piece is stronger because of a problem you solved.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>Think about a time you felt frustrated with your project. What did you do next?</p>` },
                'investigating': { title: 'Investigating', body: `<p>Investigation means you are actively looking for answers and trying things out.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>Doing some research on your topic or chosen artist.</li><li>Practicing a technique before using it on your final piece.</li><li>Solving problems as they come up.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>What is one thing you've tried that didn't work, and what did you try next?</p>` },
                'some-investigation': { title: 'Some Investigation', body: `<p>This means you are mostly sticking to what you already know how to do.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>Using familiar techniques and materials.</li><li>Following your plan without much deviation.</li><li>You might get stuck if a problem arises.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>What is one small risk you could take with your project right now?</p>` },
                'innovative-realization': { title: 'Innovative & Well-Crafted', body: `<p>This is where your unique idea and your technical skill come together perfectly.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>The artwork surprises the viewer in a good way.</li><li>The technique is so good it enhances the idea, rather than distracting from it.</li><li>Every choice (color, composition, material) feels intentional and powerful.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>Is there any part of your artwork that you could push further to make it even more unique?</p>` },
                'clear-realization': { title: 'Clear & Well-Crafted', body: `<p>The artwork successfully communicates your idea and is made with care.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>The viewer can easily understand the main idea or story.</li><li>The materials are used correctly and skillfully.</li><li>The artwork is neat, complete, and presented professionally.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>What is the most important message of your artwork? Is it coming through clearly?</p>` },
                'more-developed': { title: 'Could Be More Developed', body: `<p>This means there's a disconnect between the idea and the final product, or the craftsmanship needs more attention.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>The idea is interesting, but the artwork doesn't quite show it.</li><li>The piece might look rushed or incomplete.</li><li>There are technical issues (e.g., messy paint, weak composition) that distract the viewer.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>What is one part of your artwork you could spend 30 more minutes refining?</p>` },
                'articulate-journey': { title: 'Articulate Your Journey', body: `<p>This is about telling the story of your artwork and your own growth.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>Your artist statement connects your initial idea, your process, and the final piece.</li><li>You can talk about your challenges and what you learned from them.</li><li>You can confidently explain why you made certain artistic choices.</li><li>You can reflect on what you might do differently next time.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>If your artwork could talk, what's the most important thing it would say about its own creation?</p>` },
                'explain-project': { title: 'Explain Your Project', body: `<p>This means you can clearly describe what you did and why.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>Your artist statement describes your goal and your process.</li><li>You can answer questions about your artistic choices.</li><li>You can identify what you learned during the project.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>In three sentences, how would you describe your project to someone who has never seen it?</p>` },
                'briefly-describe': { title: 'Briefly Describe', body: `<p>This means you can state the topic of your work, but might struggle to explain the process or meaning.</p><h4 class='font-semibold mt-4 mb-2'>What this looks like:</h4><ul class='list-disc list-inside space-y-1'><li>Your artist statement is very short or just a simple label.</li><li>You might say "I don't know" when asked about your choices.</li><li>The reflection on your learning is minimal.</li></ul><h4 class='font-semibold mt-4 mb-2'>Guiding Question:</h4><p>What was one decision you made while creating this artwork? Why did you make it?</p>` }
            };

            // --- STATE ---
            let selections = {};

            // --- DOM ELEMENTS ---
            const rubricContainer = document.getElementById('rubric-container');
            const createRoadmapBtns = document.querySelectorAll('.create-roadmap-btn');

            // --- FUNCTIONS ---
            function buildRubric() {
                if (!rubricContainer) return;

                let html = '';
                const levelColors = [
                    'bg-green-100 border-green-200 text-green-900',
                    'bg-blue-100 border-blue-200 text-blue-900',
                    'bg-yellow-100 border-yellow-200 text-yellow-900',
                    'bg-red-100 border-red-200 text-red-900'
                ];
                const levelTextColors = ['text-green-700', 'text-blue-700', 'text-yellow-700', 'text-red-700'];
                const helpLinkUrl = "https://taipeiamericanschool.padlet.org/jayamohanj3/art-making-ideas-and-inspiration-v8zybaqoajrcpm27";

                rubricData.forEach((item, index) => {
                    html += `
                        <div class="rubric-section bg-white rounded-xl shadow-md overflow-hidden transition-shadow duration-300 hover:shadow-lg" data-criterion="${item.criterion}">
                            <div class="w-full flex justify-between items-center p-6">
                                <div class="flex-1">
                                    <h2 class="text-2xl font-bold text-indigo-700">${item.criterion}</h2>
                                    <p class="text-sm text-slate-500 font-medium mt-1">${item.subtitle}</p>
                                </div>
                                <div class="flex items-center ml-4">
                                    <a href="${helpLinkUrl}" target="_blank" rel="noopener noreferrer" class="help-link flex items-center gap-2 text-sm font-semibold text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-full py-2 px-4 transition-colors">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                        </svg>
                                        <span class="hidden sm:inline">Need Help?</span>
                                    </a>
                                </div>
                            </div>
                            <div class="px-6 pb-4">
                                <label for="confidence-${index}" class="block text-sm font-medium text-slate-600 mb-2">Confidence Level:</label>
                                <input type="range" id="confidence-${index}" name="confidence-${index}" min="1" max="5" value="3" class="confidence-slider w-full" data-criterion="${item.criterion}" disabled>
                                <div class="flex justify-between text-xs text-slate-500 mt-1">
                                    <span>Not Sure</span>
                                    <span>Getting There</span>
                                    <span>Very Confident</span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 p-6 pt-2">
                    `;
                    item.levels.forEach((level, levelIndex) => {
                        html += `
                                    <div class="level-card flex flex-col rounded-lg p-5 border ${levelColors[levelIndex]}" data-level-title="${level.title}" data-level-description="${level.description}" data-next-step="${level.nextStep}">
                                        <div class="flex justify-between items-start mb-2">
                                            <h4 class="text-lg font-bold ${levelTextColors[levelIndex]}">${level.title}</h4>
                                            <div class="selection-indicator h-5 w-5 rounded-full border-2 border-slate-300 bg-slate-100 flex items-center justify-center transition-all duration-200">
                                                 <svg class="checkmark h-3 w-3 text-white transition-opacity duration-200 opacity-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                                </svg>
                                            </div>
                                        </div>
                                        <p class="text-slate-700 text-base leading-relaxed">${level.description}</p>
                                    </div>
                        `;
                    });
                    html += `
                                </div>
                        </div>
                    `;
                });
                rubricContainer.innerHTML = html;
            }

            function setupInteractions() {
                const detailsModal = document.getElementById('details-modal');
                const detailsModalTitle = document.getElementById('details-modal-title');
                const detailsModalBody = document.getElementById('details-modal-body');
                const openModal = (modal) => modal.classList.add('visible');

                rubricContainer.addEventListener('click', e => {
                    const link = e.target.closest('.interactive-link');
                    if (link) {
                        e.preventDefault();
                        e.stopPropagation();
                        const modalId = link.dataset.modalId;
                        const content = modalContent[modalId];
                        if (content) {
                            detailsModalTitle.textContent = content.title;
                            detailsModalBody.innerHTML = content.body;
                            openModal(detailsModal);
                        }
                        return;
                    }

                    const selectedCard = e.target.closest('.level-card');
                    if (selectedCard) {
                        const parentSection = selectedCard.closest('.rubric-section');
                        const criterion = parentSection.dataset.criterion;
                        const levelTitle = selectedCard.dataset.levelTitle;
                        const levelDescription = selectedCard.dataset.levelDescription;
                        const nextStep = selectedCard.dataset.nextStep;
                        
                        const confidenceSlider = parentSection.querySelector('.confidence-slider');
                        confidenceSlider.disabled = false;
                        
                        selections[criterion] = { 
                            title: levelTitle, 
                            description: levelDescription,
                            nextStep: nextStep,
                            confidence: confidenceSlider.value 
                        };

                        const allCardsInSection = parentSection.querySelectorAll('.level-card');
                        allCardsInSection.forEach(card => card.classList.remove('selected-card'));
                        selectedCard.classList.add('selected-card');

                        createRoadmapBtns.forEach(btn => btn.disabled = false);
                    }
                });

                rubricContainer.addEventListener('input', e => {
                    if (e.target.classList.contains('confidence-slider')) {
                        const criterion = e.target.dataset.criterion;
                        if (selections[criterion]) {
                            selections[criterion].confidence = e.target.value;
                        }
                    }
                });
            }

            function setupModals() {
                const roadmapModal = document.getElementById('roadmap-modal');
                const mindMapModal = document.getElementById('mind-map-modal');
                const detailsModal = document.getElementById('details-modal');

                const openModal = (modal) => modal.classList.add('visible');
                const closeModal = (modal) => modal.classList.remove('visible');

                // Roadmap Modal Logic
                const roadmapModalBody = document.getElementById('roadmap-modal-body');
                const downloadPdfBtn = document.getElementById('download-pdf-btn');
                const viewMapBtn = document.getElementById('view-map-btn');

                createRoadmapBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        let roadmapHTML = '';
                        const levelTextColors = {'Exemplary': 'text-green-700', 'Proficient': 'text-blue-700', 'Developing': 'text-yellow-700', 'Beginning': 'text-red-700'};
                        const confidenceLabels = { '1': 'Not Sure', '2': 'A Little Unsure', '3': 'Getting There', '4': 'Feeling Good', '5': 'Very Confident'};

                        for (const criterion in selections) {
                            const selection = selections[criterion];
                            const colorClass = levelTextColors[selection.title] || 'text-slate-700';
                            roadmapHTML += `
                                <div>
                                    <h4 class="text-xl font-bold text-slate-800">${criterion}</h4>
                                    <div class="mt-2 border-l-4 pl-4 border-slate-200">
                                        <p class="font-semibold text-lg ${colorClass}">${selection.title}</p>
                                        <p class="text-slate-600 mb-3">${selection.description.replace(/<span class='interactive-link'.*?>(.*?)<\/span>/g, '$1')}</p>
                                        
                                        <div class="mt-3 bg-indigo-50 border border-indigo-200 rounded-lg p-3">
                                            <p class="font-bold text-sm text-indigo-800">Your Next Step:</p>
                                            <p class="text-indigo-700">${selection.nextStep}</p>
                                        </div>

                                        <div class="mt-3">
                                            <p class="font-semibold text-sm text-slate-600">Your Confidence: <span class="font-normal text-indigo-600 bg-indigo-100 py-1 px-2 rounded-md">${confidenceLabels[selection.confidence]}</span></p>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }
                        roadmapModalBody.innerHTML = roadmapHTML;
                        openModal(roadmapModal);
                    });
                });
                
                downloadPdfBtn.addEventListener('click', () => {
                    const element = document.getElementById('pdf-export-area');
                    const reflectionText = document.getElementById('reflection-text').value;
                    
                    const reflectionElement = document.createElement('div');
                    reflectionElement.className = 'mt-6';
                    reflectionElement.innerHTML = `
                        <h4 class="text-xl font-bold text-slate-800">My Goal for This Week</h4>
                        <div class="mt-2 border-l-4 pl-4 border-slate-200">
                           <p class="text-slate-600 whitespace-pre-wrap" style="font-family: 'Inter', sans-serif;">${reflectionText || 'No goal set.'}</p>
                        </div>
                    `;
                    element.appendChild(reflectionElement);

                    const opt = {
                      margin:       0.5,
                      filename:     'my-project-roadmap.pdf',
                      image:        { type: 'jpeg', quality: 0.98 },
                      html2canvas:  { scale: 2, useCORS: true },
                      jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
                    };
                    html2pdf().set(opt).from(element).save();

                    element.removeChild(reflectionElement);
                });

                viewMapBtn.addEventListener('click', () => {
                    generateMindMap();
                    openModal(mindMapModal);
                });

                // Mind Map Generation
                const downloadMapBtn = document.getElementById('download-map-btn');
                
                function generateMindMap() {
                    const container = document.getElementById('mind-map-container');
                    container.innerHTML = ''; // Clear previous map
                    const studentNameValue = document.getElementById('student-name').value;
                    const mindMapTitle = studentNameValue ? `${studentNameValue}'s Project Journey` : 'My Project Journey';
                    const confidenceLabels = { '1': 'Not Sure', '2': 'A Little Unsure', '3': 'Getting There', '4': 'Feeling Good', '5': 'Very Confident'};
                    const levelBgColors = {'Exemplary': 'bg-green-100', 'Proficient': 'bg-blue-100', 'Developing': 'bg-yellow-100', 'Beginning': 'bg-red-100'};
                    const reflectionText = document.getElementById('reflection-text').value;

                    // Center Node
                    const centerNode = document.createElement('div');
                    centerNode.className = 'absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-indigo-600 text-white p-6 rounded-full shadow-lg text-center flex items-center justify-center w-48 h-48';
                    centerNode.innerHTML = `<div class="flex flex-col"><h3 class="font-bold text-xl leading-tight">${mindMapTitle}</h3></div>`;
                    container.appendChild(centerNode);

                    const positions = [
                        { top: '0%', left: '50%', transform: 'translateX(-50%)' },   // Top
                        { top: '50%', left: '100%', transform: 'translate(-100%, -50%)' }, // Right
                        { top: '50%', left: '0%', transform: 'translateY(-50%)' },    // Left
                        { top: '100%', left: '50%', transform: 'translate(-50%, -100%)' } // Bottom
                    ];

                    rubricData.forEach((item, index) => {
                        const selection = selections[item.criterion];
                        if (!selection) return;

                        const node = document.createElement('div');
                        const bgColor = levelBgColors[selection.title] || 'bg-slate-100';
                        node.className = `absolute p-4 rounded-lg shadow-md w-72 ${bgColor}`; // Increased width
                        node.style.top = positions[index].top;
                        node.style.left = positions[index].left;
                        node.style.transform = positions[index].transform;
                        
                        const cleanDescription = selection.description.replace(/<span class='interactive-link'.*?>(.*?)<\/span>/g, '$1');

                        node.innerHTML = `
                            <h4 class="font-bold text-slate-800">${item.criterion} <span class="font-normal text-sm text-slate-500">${item.subtitle}</span></h4>
                            <p class="text-sm font-semibold text-indigo-700 mt-1">${selection.title}</p>
                            <p class="text-xs text-slate-600 mt-2">${cleanDescription}</p>
                            <p class="text-xs text-slate-800 mt-2 italic bg-white/50 p-1 rounded"><strong>Next Step:</strong> "${selection.nextStep}"</p>
                            <div class="text-xs mt-2 font-semibold text-slate-600">Confidence: <span class="font-normal text-indigo-600 bg-indigo-200/50 py-0.5 px-1.5 rounded-md">${confidenceLabels[selection.confidence]}</span></div>
                        `;
                        container.appendChild(node);
                        
                        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                        svg.setAttribute('class', 'absolute top-0 left-0 w-full h-full -z-10');
                        svg.style.pointerEvents = 'none';
                        
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', '50%');
                        line.setAttribute('y1', '50%');
                        
                        let x2, y2;
                        switch(index) {
                            case 0: x2 = '50%'; y2 = '15%'; break; 
                            case 1: x2 = '85%'; y2 = '50%'; break; 
                            case 2: x2 = '15%'; y2 = '50%'; break; 
                            case 3: x2 = '50%'; y2 = '85%'; break;
                        }
                        line.setAttribute('x2', x2);
                        line.setAttribute('y2', y2);
                        line.setAttribute('stroke', '#cbd5e1');
                        line.setAttribute('stroke-width', '2');
                        
                        svg.appendChild(line);
                        container.insertBefore(svg, centerNode);
                    });
                    
                    // Add Goal Node if text exists
                    if (reflectionText) {
                        const goalNode = document.createElement('div');
                        goalNode.className = 'absolute p-4 rounded-lg shadow-md w-72 bg-fuchsia-100';
                        goalNode.style.top = '100%';
                        goalNode.style.left = '0%';
                        goalNode.style.transform = 'translateY(-100%)';
                        goalNode.innerHTML = `
                            <h4 class="font-bold text-fuchsia-800">My Goal for This Week</h4>
                            <p class="text-xs text-slate-600 mt-2 italic">"${reflectionText}"</p>
                        `;
                        container.appendChild(goalNode);
                        
                        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                        svg.setAttribute('class', 'absolute top-0 left-0 w-full h-full -z-10');
                        svg.style.pointerEvents = 'none';
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', '50%');
                        line.setAttribute('y1', '50%');
                        line.setAttribute('x2', '15%');
                        line.setAttribute('y2', '85%');
                        line.setAttribute('stroke', '#cbd5e1');
                        line.setAttribute('stroke-width', '2');
                        svg.appendChild(line);
                        container.insertBefore(svg, centerNode);
                    }
                }

                downloadMapBtn.addEventListener('click', () => {
                    const mapContainer = document.getElementById('mind-map-container');
                    html2canvas(mapContainer, {
                        backgroundColor: '#f8fafc', // slate-50
                        scale: 2,
                        useCORS: true
                    }).then(canvas => {
                        const link = document.createElement('a');
                        link.download = 'my-project-mind-map.png';
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    });
                });

                // Generic Modal Close Logic
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.addEventListener('click', e => {
                        if (e.target === modal || e.target.closest('.modal-close-button') || e.target.closest('.modal-close-icon')) {
                            closeModal(modal);
                        }
                    });
                });
                
                document.addEventListener('keydown', e => {
                    if (e.key === 'Escape') {
                        document.querySelectorAll('.modal-overlay.visible').forEach(closeModal);
                    }
                });
            }
            
            // --- INITIALIZATION ---
            buildRubric();
            setupInteractions(); // Use the new unified interaction handler
            setupModals();
        });
    </script>
</body>
</html>
